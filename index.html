<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TikTok Downloader — UI</title>
  <meta name="description" content="Antarmuka sederhana untuk mengunduh video TikTok menggunakan backend Anda." />
  <style>
    :root{--bg:#0b1220;--card:#0f1724;--muted:#98a0aa;--accent:#06b6d4}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071024 0%,#08142b 100%);color:#e6eef6}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:24px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    header{display:flex;gap:14px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021025}
    h1{margin:0;font-size:20px}
    p.lead{color:var(--muted);margin:6px 0 16px}
    .controls{display:grid;grid-template-columns:1fr 260px;gap:14px}
    input[type=url],select{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:inherit}
    .btn{padding:12px;border-radius:10px;border:none;font-weight:600;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--accent),#8b5cf6);color:#021025}
    .muted{color:var(--muted);font-size:13px}
    .preview{margin-top:18px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
    video{width:100%;border-radius:10px;background:#000}
    .meta{display:flex;gap:10px;align-items:center;margin-top:10px;flex-wrap:wrap}
    .badge{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);font-size:13px}
    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:18px;color:var(--muted);font-size:13px}
    @media (max-width:780px){.controls{grid-template-columns:1fr}.logo{width:48px;height:48px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <header>
        <div class="logo">TD</div>
        <div>
          <h1>TikTok Downloader — Gratis</h1>
          <p class="lead">Tempelkan link TikTok, pilih opsi lalu tekan <strong>Ambil</strong>. Antarmuka ini terhubung ke backend yang kamu sediakan.</p>
        </div>
      </header>

```
  <form id="dlForm" class="controls" onsubmit="return false;">
    <div>
      <input id="urlInput" type="url" placeholder="Masukkan URL TikTok (mis. https://www.tiktok.com/...)" required>

      <div style="display:flex;gap:8px;margin-top:10px">
        <select id="formatSelect">
          <option value="video">Video (MP4)</option>
          <option value="audio">Audio (MP3)</option>
        </select>
        <select id="qualitySelect">
          <option value="best">Kualitas: Terbaik</option>
          <option value="medium">Sedang</option>
          <option value="low">Rendah</option>
        </select>
      </div>

      <div class="muted" style="margin-top:10px">Catatan: backend akan dihubungi di <code id="backendUrl"></code></div>
    </div>

    <div style="display:flex;flex-direction:column;gap:8px">
      <button id="fetchBtn" class="btn btn-primary">Ambil</button>
      <label style="display:flex;align-items:center;gap:8px;font-size:13px"><input id="noWm" type="checkbox"> Tanpa watermark</label>
      <button id="clearBtn" type="button" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);">Bersihkan</button>
    </div>
  </form>

  <div id="resultArea" class="preview" hidden>
    <div id="previewContainer"></div>

    <div class="meta">
      <div class="badge" id="metaTitle">Judul: -</div>
      <div class="badge" id="metaAuthor">Pengguna: -</div>
      <div class="badge" id="metaDuration">Durasi: -</div>
    </div>

    <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
      <a id="downloadLink" class="btn btn-primary" href="#">Download</a>
      <button id="copyBtn" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);">Salin Link</button>
      <div id="status" class="muted">Status: Siap</div>
    </div>
  </div>

  <div class="footer">
    <div>⚖️ Pastikan Anda punya hak untuk mengunduh/menyimpan konten — gunakan hanya untuk konten yang diizinkan.</div>
    <div class="muted">v1 • UI terhubung ke backend</div>
  </div>
</div>
```

  </div>

  <script>
    // === CONFIG: ganti baseBackend jika perlu ===
    const baseBackend = 'https://mesin-website-rizal-ke-2.onrender.com';
    document.getElementById('backendUrl').textContent = baseBackend + '/api/*';

    // Elements
    const urlInput = document.getElementById('urlInput');
    const fetchBtn = document.getElementById('fetchBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resultArea = document.getElementById('resultArea');
    const previewContainer = document.getElementById('previewContainer');
    const downloadLink = document.getElementById('downloadLink');
    const status = document.getElementById('status');
    const metaTitle = document.getElementById('metaTitle');
    const metaAuthor = document.getElementById('metaAuthor');
    const metaDuration = document.getElementById('metaDuration');
    const copyBtn = document.getElementById('copyBtn');
    const noWm = document.getElementById('noWm');
    const formatSelect = document.getElementById('formatSelect');

    function isProbablyTikTok(url){
      try{ const u = new URL(url); return /tiktok.com/.test(u.hostname) || /vm.tiktok.com/.test(u.hostname);}catch(e){return false}
    }

    fetchBtn.addEventListener('click', async ()=>{
      const url = urlInput.value.trim();
      if(!url){alert('Masukkan URL dulu.'); return}
      if(!isProbablyTikTok(url)){ if(!confirm('URL tidak terlihat seperti tiktok.com — lanjutkan?')) return }

      status.textContent = 'Mengambil metadata...';
      fetchBtn.disabled = true;
      resultArea.hidden = true;

      try{
        // Panggil endpoint /api/info untuk mendapatkan metadata (lebih aman)
        const infoRes = await fetch(baseBackend + '/api/info?url=' + encodeURIComponent(url));
        if(!infoRes.ok) throw new Error('Gagal menerima metadata dari backend');
        const infoJson = await infoRes.json();
        if(!infoJson.success) throw new Error(infoJson.error || 'Backend mengembalikan kesalahan');

        const data = infoJson.data;

        // Prepare preview and download link. Backend kita menyediakan /api/download yang melakukan redirect.
        const downloadParams = new URLSearchParams();
        downloadParams.set('url', url);
        if(noWm.checked) downloadParams.set('no_wm', 'true');
        if(formatSelect.value === 'audio') downloadParams.set('audio', 'true');

        const downloadUrl = baseBackend + '/api/download?' + downloadParams.toString();

        // Populate preview (video if possible)
        previewContainer.innerHTML = '';
        if(formatSelect.value === 'video'){
          const v = document.createElement('video');
          v.controls = true; v.src = downloadUrl; v.preload = 'metadata'; v.className = '';
          previewContainer.appendChild(v);
        } else {
          const p = document.createElement('div');
          p.textContent = 'Audio ready — klik Download untuk mengunduh file audio.';
          previewContainer.appendChild(p);
        }

        metaTitle.textContent = 'Judul: ' + (data.title || '-');
        metaAuthor.textContent = 'Pengguna: ' + (data.author || '-');
        metaDuration.textContent = 'Durasi: ' + (data.duration ? data.duration + 's' : '-');

        downloadLink.href = downloadUrl;
        downloadLink.setAttribute('download', formatSelect.value === 'video' ? 'tiktok_video.mp4' : 'tiktok_audio.mp3');

        resultArea.hidden = false;
        status.textContent = 'Selesai — siap unduh.';

      }catch(err){
        console.error(err);
        alert('Gagal: ' + err.message);
        status.textContent = 'Error';
      }finally{
        fetchBtn.disabled = false;
      }
    });

    clearBtn.addEventListener('click', ()=>{
      urlInput.value = '';
      resultArea.hidden = true;
      status.textContent = 'Siap';
    });

    copyBtn.addEventListener('click', ()=>{
      if(!downloadLink.href){alert('Belum ada link');return}
      navigator.clipboard.writeText(downloadLink.href).then(()=>{
        status.textContent = 'Link disalin ke clipboard.';
      }).catch(()=>status.textContent = 'Gagal menyalin.');
    });

    urlInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ fetchBtn.click(); e.preventDefault(); } });
  </script>

</body>
</html>
